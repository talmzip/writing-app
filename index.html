<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Minimalist Writing App</title>
<style>
  html, body {
    margin: 0; padding: 0; background: white; height: 100%;
    display: flex; justify-content: center; align-items: center;
  }
  #text {
    font-family: monospace;
    white-space: pre-wrap;
    text-align: center;
    width: 40ch;
    max-width: 80vw;
    hyphens: none;
    overflow-y: auto; /* allow scrolling */
    line-height: 1.4;
    border: 1px solid #eee;
    padding: 10px;
    box-sizing: border-box;
    height: calc(1.4em * 7); /* 7 lines tall, approx */
  }
  .cursor {
    display: inline-block;
    width: 4px;
    height: 1em;
    background: black;
    vertical-align: bottom;
    animation: blink 1s infinite;
  }
  @keyframes blink {
    0%, 50% { opacity: 1; }
    50.1%, 100% { opacity: 0; }
  }
</style>
</head>
<body>
  <div id="text" tabindex="0"><span id="content"></span><span class="cursor"></span></div>

<script>
  let contentEl = document.getElementById('content');
  let textContainer = document.getElementById('text');

  const maxWords = 110;
  const maxCharsPerLine = 40;
  const lineCount = 7;

  const startFontSize = 48; // px
  const minFontSize = 16;   // px

  let rawText = '';

  // Focus container to capture keys and paste
  textContainer.focus();

  // Handle typing
  textContainer.addEventListener('keydown', (e) => {
    e.preventDefault();

    if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
      // Limit words count
      const currentWords = rawText.trim().split(/\s+/).filter(Boolean).length;
      if (currentWords < maxWords) {
        rawText += e.key;
      }
    } else if (e.key === 'Backspace') {
      rawText = rawText.slice(0, -1);
    } else if (e.key === 'Enter') {
      rawText += '\n';
    }
    updateDisplay();
    adjustFontSizeAndHeight();
    scrollToBottom();
  });

  // Handle paste
  textContainer.addEventListener('paste', (e) => {
    e.preventDefault();
    let pasteText = (e.clipboardData || window.clipboardData).getData('text');
    // Add pasted text if under max words
    const currentWords = rawText.trim().split(/\s+/).filter(Boolean).length;
    const pasteWords = pasteText.trim().split(/\s+/).filter(Boolean).length;

    if (currentWords + pasteWords <= maxWords) {
      rawText += pasteText;
    } else {
      // If pasted text would overflow maxWords, trim it
      let allowedWords = maxWords - currentWords;
      let allowedText = pasteText.trim().split(/\s+/).slice(0, allowedWords).join(' ');
      rawText += allowedText + ' ';
    }
    updateDisplay();
    adjustFontSizeAndHeight();
    scrollToBottom();
  });

  function updateDisplay() {
    // Remove line breaks for splitting
    let textNoLineBreaks = rawText.replace(/\n/g, '');

    // Break into fixed length chunks
    let lines = [];
    for (let i = 0; i < textNoLineBreaks.length; i += maxCharsPerLine) {
      lines.push(textNoLineBreaks.substr(i, maxCharsPerLine));
    }
    // Join with explicit line breaks
    let fixedLinesText = lines.join('\n');

    contentEl.textContent = fixedLinesText;
  }

  function adjustFontSizeAndHeight() {
    let words = rawText.trim().split(/\s+/).filter(Boolean);
    let wordCount = words.length;

    if (wordCount > maxWords) wordCount = maxWords;

    let ratio = 1 - (wordCount / maxWords);
    let newSize = minFontSize + ratio * (startFontSize - minFontSize);

    textContainer.style.fontSize = newSize + 'px';
    let lineHeight = 1.4;
    textContainer.style.height = (lineCount * lineHeight * newSize) + 'px';
  }

  function scrollToBottom() {
    textContainer.scrollTop = textContainer.scrollHeight;
  }
</script>
</body>
</html>
